/*! imboclient v2.3.0 2014-03-17 */
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Imbo=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){c.Client=a("./lib/client"),c.Url=a("./lib/url"),c.ImageUrl=a("./lib/imageurl"),c.Query=a("./lib/query"),c.Version=a("./package.json").version},{"./lib/client":8,"./lib/imageurl":9,"./lib/query":10,"./lib/url":11,"./package.json":15}],2:[function(a,b){(function(c){"use strict";var d,e=function(){if("undefined"==typeof window.Worker||"undefined"==typeof window.URL)return!1;try{new Worker(window.URL.createObjectURL(new Blob([""],{type:"text/javascript"})))}catch(a){return!1}return!0},f=a("./sha"),g=a("./md5.min"),h=a("./readers"),i=e(),j=[],k=function(){j.length>1||j.length&&d.postMessage(j[0].buffer)},l=function(a,b){i?(j.push({buffer:a,callback:b}),k()):c.nextTick(function(){b(void 0,g.ArrayBuffer.hash(a))})};i&&(d=new Worker(window.URL.createObjectURL(new Blob([';(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module \'"+n+"\'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(require,module,exports){\n(function(){/* global self */\n\'use strict\';\nvar md5 = require(\'./md5.min\');\nself.onmessage = function(e) {\n    self.postMessage(md5.ArrayBuffer.hash(e.data));\n};\n})()\n},{"./md5.min":2}],2:[function(require,module,exports){\n(function(r){module.exports=r()})(function(r){"use strict";var n=function(r,n){return r+n&4294967295},t=function(r,t,u,e,o,f){t=n(n(t,r),n(e,f));return n(t<<o|t>>>32-o,u)},u=function(r,n,u,e,o,f,a){return t(n&u|~n&e,r,n,o,f,a)},e=function(r,n,u,e,o,f,a){return t(n&e|u&~e,r,n,o,f,a)},o=function(r,n,u,e,o,f,a){return t(n^u^e,r,n,o,f,a)},f=function(r,n,u,e,o,f,a){return t(u^(n|~e),r,n,o,f,a)},a=function(r,t){var a=r[0],i=r[1],c=r[2],h=r[3];a=u(a,i,c,h,t[0],7,-680876936);h=u(h,a,i,c,t[1],12,-389564586);c=u(c,h,a,i,t[2],17,606105819);i=u(i,c,h,a,t[3],22,-1044525330);a=u(a,i,c,h,t[4],7,-176418897);h=u(h,a,i,c,t[5],12,1200080426);c=u(c,h,a,i,t[6],17,-1473231341);i=u(i,c,h,a,t[7],22,-45705983);a=u(a,i,c,h,t[8],7,1770035416);h=u(h,a,i,c,t[9],12,-1958414417);c=u(c,h,a,i,t[10],17,-42063);i=u(i,c,h,a,t[11],22,-1990404162);a=u(a,i,c,h,t[12],7,1804603682);h=u(h,a,i,c,t[13],12,-40341101);c=u(c,h,a,i,t[14],17,-1502002290);i=u(i,c,h,a,t[15],22,1236535329);a=e(a,i,c,h,t[1],5,-165796510);h=e(h,a,i,c,t[6],9,-1069501632);c=e(c,h,a,i,t[11],14,643717713);i=e(i,c,h,a,t[0],20,-373897302);a=e(a,i,c,h,t[5],5,-701558691);h=e(h,a,i,c,t[10],9,38016083);c=e(c,h,a,i,t[15],14,-660478335);i=e(i,c,h,a,t[4],20,-405537848);a=e(a,i,c,h,t[9],5,568446438);h=e(h,a,i,c,t[14],9,-1019803690);c=e(c,h,a,i,t[3],14,-187363961);i=e(i,c,h,a,t[8],20,1163531501);a=e(a,i,c,h,t[13],5,-1444681467);h=e(h,a,i,c,t[2],9,-51403784);c=e(c,h,a,i,t[7],14,1735328473);i=e(i,c,h,a,t[12],20,-1926607734);a=o(a,i,c,h,t[5],4,-378558);h=o(h,a,i,c,t[8],11,-2022574463);c=o(c,h,a,i,t[11],16,1839030562);i=o(i,c,h,a,t[14],23,-35309556);a=o(a,i,c,h,t[1],4,-1530992060);h=o(h,a,i,c,t[4],11,1272893353);c=o(c,h,a,i,t[7],16,-155497632);i=o(i,c,h,a,t[10],23,-1094730640);a=o(a,i,c,h,t[13],4,681279174);h=o(h,a,i,c,t[0],11,-358537222);c=o(c,h,a,i,t[3],16,-722521979);i=o(i,c,h,a,t[6],23,76029189);a=o(a,i,c,h,t[9],4,-640364487);h=o(h,a,i,c,t[12],11,-421815835);c=o(c,h,a,i,t[15],16,530742520);i=o(i,c,h,a,t[2],23,-995338651);a=f(a,i,c,h,t[0],6,-198630844);h=f(h,a,i,c,t[7],10,1126891415);c=f(c,h,a,i,t[14],15,-1416354905);i=f(i,c,h,a,t[5],21,-57434055);a=f(a,i,c,h,t[12],6,1700485571);h=f(h,a,i,c,t[3],10,-1894986606);c=f(c,h,a,i,t[10],15,-1051523);i=f(i,c,h,a,t[1],21,-2054922799);a=f(a,i,c,h,t[8],6,1873313359);h=f(h,a,i,c,t[15],10,-30611744);c=f(c,h,a,i,t[6],15,-1560198380);i=f(i,c,h,a,t[13],21,1309151649);a=f(a,i,c,h,t[4],6,-145523070);h=f(h,a,i,c,t[11],10,-1120210379);c=f(c,h,a,i,t[2],15,718787259);i=f(i,c,h,a,t[9],21,-343485551);r[0]=n(a,r[0]);r[1]=n(i,r[1]);r[2]=n(c,r[2]);r[3]=n(h,r[3])},i=function(r){var n=[],t;for(t=0;t<64;t+=4){n[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24)}return n},c=function(r){var n=[],t;for(t=0;t<64;t+=4){n[t>>2]=r[t]+(r[t+1]<<8)+(r[t+2]<<16)+(r[t+3]<<24)}return n},h=function(r){var n=r.length,t=[1732584193,-271733879,-1732584194,271733878],u,e,o,f,c,h;for(u=64;u<=n;u+=64){a(t,i(r.substring(u-64,u)))}r=r.substring(u-64);e=r.length;o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(u=0;u<e;u+=1){o[u>>2]|=r.charCodeAt(u)<<(u%4<<3)}o[u>>2]|=128<<(u%4<<3);if(u>55){a(t,o);for(u=0;u<16;u+=1){o[u]=0}}f=n*8;f=f.toString(16).match(/(.*?)(.{0,8})$/);c=parseInt(f[2],16);h=parseInt(f[1],16)||0;o[14]=c;o[15]=h;a(t,o);return t},s=function(r){var n=r.length,t=[1732584193,-271733879,-1732584194,271733878],u,e,o,f,i,h;for(u=64;u<=n;u+=64){a(t,c(r.subarray(u-64,u)))}r=u-64<n?r.subarray(u-64):new Uint8Array(0);e=r.length;o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(u=0;u<e;u+=1){o[u>>2]|=r[u]<<(u%4<<3)}o[u>>2]|=128<<(u%4<<3);if(u>55){a(t,o);for(u=0;u<16;u+=1){o[u]=0}}f=n*8;f=f.toString(16).match(/(.*?)(.{0,8})$/);i=parseInt(f[2],16);h=parseInt(f[1],16)||0;o[14]=i;o[15]=h;a(t,o);return t},v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],d=function(r){var n="",t;for(t=0;t<4;t+=1){n+=v[r>>t*8+4&15]+v[r>>t*8&15]}return n},g=function(r){var n;for(n=0;n<r.length;n+=1){r[n]=d(r[n])}return r.join("")},A=function(r){return g(h(r))};var b=function(){this.reset()};if(A("hello")!=="5d41402abc4b2a76b9719d911017c592"){n=function(r,n){var t=(r&65535)+(n&65535),u=(r>>16)+(n>>16)+(t>>16);return u<<16|t&65535}}b.ArrayBuffer=function(){};b.ArrayBuffer.hash=function(r){return g(s(new Uint8Array(r)))};return b});\n},{}]},{},[1])\n;'],{type:"text/javascript"}))),d.addEventListener("message",function(a){var b=j.shift();b.callback(void 0,a.data),k()},!1)),b.exports={sha256:function(a,b){return f.sha256hmac(a,b)},md5:function(a,d,e){return e&&"url"===e.type?h.getContentsFromUrl(a,function(a,c){b.exports.md5(c,d,{binary:!0})}):a instanceof window.File?h.getContentsFromFile(a,function(a,c){b.exports.md5(c,d,{binary:!0})}):void c.nextTick(function(){l(a,d)})}}}).call(this,a("/var/www/imboclient-js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./md5.min":4,"./readers":5,"./sha":7,"/var/www/imboclient-js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":14}],3:[function(a,b,c){"use strict";c.checkFeatures=function(a){if("undefined"!=typeof window||a){var b=c.getUnsupported(a);if(b.length)throw new Error("Browser does not support "+b.join(", "))}},c.getUnsupported=function(a){var b=a||window,c=[];return b.FileReader||c.push("FileReader"),b.ArrayBuffer||c.push("ArrayBuffer"),b.XMLHttpRequest?"upload"in new b.XMLHttpRequest||c.push("XMLHttpRequest2"):c.push("XMLHttpRequest"),c}},{}],4:[function(a,b){!function(a){b.exports=a()}(function(){"use strict";var a=function(a,b){return a+b&4294967295},b=function(b,c,d,e,f,g){return c=a(a(c,b),a(e,g)),a(c<<f|c>>>32-f,d)},c=function(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)},d=function(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)},e=function(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)},f=function(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)},g=function(b,g){var h=b[0],i=b[1],j=b[2],k=b[3];h=c(h,i,j,k,g[0],7,-680876936),k=c(k,h,i,j,g[1],12,-389564586),j=c(j,k,h,i,g[2],17,606105819),i=c(i,j,k,h,g[3],22,-1044525330),h=c(h,i,j,k,g[4],7,-176418897),k=c(k,h,i,j,g[5],12,1200080426),j=c(j,k,h,i,g[6],17,-1473231341),i=c(i,j,k,h,g[7],22,-45705983),h=c(h,i,j,k,g[8],7,1770035416),k=c(k,h,i,j,g[9],12,-1958414417),j=c(j,k,h,i,g[10],17,-42063),i=c(i,j,k,h,g[11],22,-1990404162),h=c(h,i,j,k,g[12],7,1804603682),k=c(k,h,i,j,g[13],12,-40341101),j=c(j,k,h,i,g[14],17,-1502002290),i=c(i,j,k,h,g[15],22,1236535329),h=d(h,i,j,k,g[1],5,-165796510),k=d(k,h,i,j,g[6],9,-1069501632),j=d(j,k,h,i,g[11],14,643717713),i=d(i,j,k,h,g[0],20,-373897302),h=d(h,i,j,k,g[5],5,-701558691),k=d(k,h,i,j,g[10],9,38016083),j=d(j,k,h,i,g[15],14,-660478335),i=d(i,j,k,h,g[4],20,-405537848),h=d(h,i,j,k,g[9],5,568446438),k=d(k,h,i,j,g[14],9,-1019803690),j=d(j,k,h,i,g[3],14,-187363961),i=d(i,j,k,h,g[8],20,1163531501),h=d(h,i,j,k,g[13],5,-1444681467),k=d(k,h,i,j,g[2],9,-51403784),j=d(j,k,h,i,g[7],14,1735328473),i=d(i,j,k,h,g[12],20,-1926607734),h=e(h,i,j,k,g[5],4,-378558),k=e(k,h,i,j,g[8],11,-2022574463),j=e(j,k,h,i,g[11],16,1839030562),i=e(i,j,k,h,g[14],23,-35309556),h=e(h,i,j,k,g[1],4,-1530992060),k=e(k,h,i,j,g[4],11,1272893353),j=e(j,k,h,i,g[7],16,-155497632),i=e(i,j,k,h,g[10],23,-1094730640),h=e(h,i,j,k,g[13],4,681279174),k=e(k,h,i,j,g[0],11,-358537222),j=e(j,k,h,i,g[3],16,-722521979),i=e(i,j,k,h,g[6],23,76029189),h=e(h,i,j,k,g[9],4,-640364487),k=e(k,h,i,j,g[12],11,-421815835),j=e(j,k,h,i,g[15],16,530742520),i=e(i,j,k,h,g[2],23,-995338651),h=f(h,i,j,k,g[0],6,-198630844),k=f(k,h,i,j,g[7],10,1126891415),j=f(j,k,h,i,g[14],15,-1416354905),i=f(i,j,k,h,g[5],21,-57434055),h=f(h,i,j,k,g[12],6,1700485571),k=f(k,h,i,j,g[3],10,-1894986606),j=f(j,k,h,i,g[10],15,-1051523),i=f(i,j,k,h,g[1],21,-2054922799),h=f(h,i,j,k,g[8],6,1873313359),k=f(k,h,i,j,g[15],10,-30611744),j=f(j,k,h,i,g[6],15,-1560198380),i=f(i,j,k,h,g[13],21,1309151649),h=f(h,i,j,k,g[4],6,-145523070),k=f(k,h,i,j,g[11],10,-1120210379),j=f(j,k,h,i,g[2],15,718787259),i=f(i,j,k,h,g[9],21,-343485551),b[0]=a(h,b[0]),b[1]=a(i,b[1]),b[2]=a(j,b[2]),b[3]=a(k,b[3])},h=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c},i=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},j=function(a){var b,c,d,e,f,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,h(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),i=parseInt(e[1],16)||0,d[14]=f,d[15]=i,g(k,d),k},k=function(a){var b,c,d,e,f,h,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,i(a.subarray(b-64,b)));for(a=j>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),h=parseInt(e[1],16)||0,d[14]=f,d[15]=h,g(k,d),k},l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],m=function(a){var b,c="";for(b=0;4>b;b+=1)c+=l[a>>8*b+4&15]+l[a>>8*b&15];return c},n=function(a){var b;for(b=0;b<a.length;b+=1)a[b]=m(a[b]);return a.join("")},o=function(a){return n(j(a))},p=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==o("hello")&&(a=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),p.ArrayBuffer=function(){},p.ArrayBuffer.hash=function(a){return n(k(new Uint8Array(a)))},p})},{}],5:[function(a,b,c){"use strict";c.getContentsFromFile=function(a,b){var c=new FileReader;c.onload=function(a){return b(void 0,a.target.result)},c.readAsArrayBuffer(a)},c.getContentsFromUrl=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.onreadystatechange=function(){4===c.readyState&&b(void 0,c.responseText)},c.send(null)}},{}],6:[function(a,b){"use strict";function c(a){a.method=a.method.toUpperCase(),a.uri=a.uri.toString();var b=new XMLHttpRequest;b.onreadystatechange=function(){4===b.readyState&&0!==b.status&&a.onComplete&&a.onComplete(b.status>=400?b.status+" "+b.statusText:void 0,e(b),a.json?JSON.parse(b.responseText):b.responseText)},b.onerror=function(){a.onComplete("XHR error - CORS denied?",e(b))},a.onProgress&&b.upload.addEventListener("progress",a.onProgress,!1),b.open(a.method,a.uri,!0);for(var c in a.headers)d.indexOf(c)>-1||b.setRequestHeader(c,a.headers[c]);a.json&&(b.setRequestHeader("Accept","application/json"),"boolean"!=typeof a.json&&(b.setRequestHeader("Content-Type","application/json"),a.body=JSON.stringify(a.json))),b.send(a.body)}var d=["User-Agent","Content-Length"],e=function(a){for(var b={headers:{},statusCode:a.status},c=a.getAllResponseHeaders().split("\r\n"),d=0;d<c.length;d++){var e=c[d],f=e.indexOf(": ");if(f>0){var g=e.substring(0,f),h=e.substring(f+2);b.headers[g.toLowerCase()]=h}}return b};c.short=function(a,b,d){var e={method:a,uri:b,onComplete:d};"GET"===a&&(e.json=!0),c(e)},c.get=function(a,b){c.short("GET",a,b)},c.del=function(a,b){c.short("DELETE",a,b)},c.head=function(a,b){c.short("HEAD",a,b)},b.exports=c},{}],7:[function(a,b,c){"use strict";var d=8,e=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},f=function(a,b){return a>>>b|a<<32-b},g=function(a,b){return a>>>b},h=function(a,b,c){return a&b^~a&c},i=function(a,b,c){return a&b^a&c^b&c},j=function(a){return f(a,2)^f(a,13)^f(a,22)},k=function(a){return f(a,6)^f(a,11)^f(a,25)},l=function(a){return f(a,7)^f(a,18)^g(a,3)},m=function(a){return f(a,17)^f(a,19)^g(a,10)},n=function(a,b){var c,d,f,g,n,o,p,q,r,s,t,u,v=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],w=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],x=new Array(64);for(a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b,r=0;r<a.length;r+=16){for(c=w[0],d=w[1],f=w[2],g=w[3],n=w[4],o=w[5],p=w[6],q=w[7],s=0;64>s;s++)x[s]=16>s?a[s+r]:e(e(e(m(x[s-2]),x[s-7]),l(x[s-15])),x[s-16]),t=e(e(e(e(q,k(n)),h(n,o,p)),v[s]),x[s]),u=e(j(c),i(c,d,f)),q=p,p=o,o=n,n=e(g,t),g=f,f=d,d=c,c=e(t,u);w[0]=e(c,w[0]),w[1]=e(d,w[1]),w[2]=e(f,w[2]),w[3]=e(g,w[3]),w[4]=e(n,w[4]),w[5]=e(o,w[5]),w[6]=e(p,w[6]),w[7]=e(q,w[7])}return w},o=function(a){for(var b=Array(),c=(1<<d)-1,e=0;e<a.length*d;e+=d)b[e>>5]|=(a.charCodeAt(e/d)&c)<<24-e%32;return b},p=function(a){for(var b="0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>8*(3-d%4)+4&15)+b.charAt(a[d>>2]>>8*(3-d%4)&15);return c},q=function(a,b){var c=o(a);c.length>16&&(c=n(c,a.length*d));for(var e=new Array(16),f=new Array(16),g=0;16>g;g++)e[g]=909522486^c[g],f[g]=1549556828^c[g];var h=n(e.concat(o(b)),512+b.length*d);return n(f.concat(h),768)};c.sha256=function(a){return p(n(a,a.length*d))},c.sha256hmac=function(a,b){return p(q(a,b))}},{}],8:[function(a,b){"use strict";var c=a("./url"),d=a("./imageurl"),e=a("./query"),f=a("./utils/extend"),g=a("./utils/jsonparse"),h=a("./browser/crypto"),i=a("./browser/request"),j=a("./browser/readers"),k=a("./browser/feature-support"),l=function(a,b,c){this.options={hosts:this.parseUrls(a),publicKey:b,privateKey:c},k.checkFeatures()};f(l.prototype,{addImage:function(a,b){return"undefined"!=typeof window&&a instanceof window.File?this.addImageFromBuffer(a,b):void j.getLengthOfFile(a,function(c,d){return c?b(c):void j.createReadStream(a).pipe(i({method:"POST",uri:this.getSignedResourceUrl("POST",this.getImagesUrl()),json:!0,headers:{Accept:"application/json","User-Agent":"imboclient-js","Content-Length":d},onComplete:function(a,c,d){b(a,d?d.imageIdentifier:void 0,d,c)}}))}.bind(this))},addImageFromBuffer:function(a,b){var c=this.getSignedResourceUrl("POST",this.getImagesUrl()),d="undefined"!=typeof window&&a instanceof window.File,e=b.onComplete||b,f=b.onProgress||null;i({method:"POST",uri:c,body:a,headers:{Accept:"application/json","User-Agent":"imboclient-js","Content-Length":d?a.size:a.length},onComplete:function(a,b,c){c=g(c),e(a,c?c.imageIdentifier:void 0,c,b)},onProgress:f})},addImageFromUrl:function(a,b){return"undefined"!=typeof window?j.getContentsFromUrl(a,function(a,c,d){return a?b(a):void this.addImageFromBuffer(d,b)}.bind(this)):void i({uri:a}).pipe(i({method:"POST",uri:this.getSignedResourceUrl("POST",this.getImagesUrl()),json:!0,headers:{Accept:"application/json","User-Agent":"imboclient-js"},onComplete:function(a,c,d){b(a,d?d.imageIdentifier:void 0,d,c)}}))},getServerStats:function(a){i.get(this.getStatsUrl(),function(b,c,d){a(b,d,c)})},getServerStatus:function(a){i.get(this.getStatusUrl(),function(b,c,d){return b?a(b):(d=d||{},d.status=c.statusCode,d.date=new Date(d.date),void a(b,d,c))})},getUserInfo:function(a){i.get(this.getUserUrl(),function(b,c,d){d&&d.lastModified&&(d.lastModified=new Date(d.lastModified)),a(b,d,c)})},deleteImage:function(a,b){var c=this.getImageUrl(a,{usePrimaryHost:!0}),d=this.getSignedResourceUrl("DELETE",c);i.del(d,b)},getImageProperties:function(a,b){this.headImage(a,function(a,c){if(a)return b(a);var d=c.headers,e="x-imbo-original";b(a,{width:parseInt(d[e+"width"],10),height:parseInt(d[e+"height"],10),filesize:parseInt(d[e+"filesize"],10),extension:d[e+"extension"],mimetype:d[e+"mimetype"]})})},editMetadata:function(a,b,c,d){var e=this.getMetadataUrl(a);i({method:d||"POST",uri:this.getSignedResourceUrl(d||"POST",e),json:b,onComplete:function(a,b,d){c(a,d,b)}})},replaceMetadata:function(a,b,c){this.editMetadata(a,b,c,"PUT")},getMetadata:function(a,b){i.get(this.getMetadataUrl(a),function(a,c,d){b(a,d,c)})},deleteMetadata:function(a,b){var c=this.getMetadataUrl(a);i.del(this.getSignedResourceUrl("DELETE",c),b)},getImages:function(a,b){"function"!=typeof a||b||(b=a,a=null),i.get(this.getImagesUrl(a),function(a,c,d){b(a,d?d.images:[],d?d.search:{},c)})},getStatusUrl:function(){return this.getResourceUrl({path:"/status"})},getStatsUrl:function(){return this.getResourceUrl({path:"/stats"})},getUserUrl:function(){return this.getResourceUrl({path:"/users/"+this.options.publicKey})},getImagesUrl:function(a){var b=this.getUserUrl();return b.setPath(b.getPath()+"/images"),a&&b.setQueryString(a.toString()),b},getImageUrl:function(a,b){return b=b||{},new d({baseUrl:this.getHostForImageIdentifier(a,b.usePrimaryHost),path:b.path,publicKey:this.options.publicKey,privateKey:this.options.privateKey,imageIdentifier:a})},getMetadataUrl:function(a){return this.getImageUrl(a,{path:"/meta",usePrimaryHost:!0})},getResourceUrl:function(a){return new c({baseUrl:this.options.hosts[0],publicKey:this.options.publicKey,privateKey:this.options.privateKey,queryString:a.query,path:a.path})},getShortUrl:function(a,b){i.head(a.toString(),function(a,c){return a?b(a):c&&c.headers["x-imbo-shorturl"]?void b(a,c.headers["x-imbo-shorturl"]):b("No ShortUrl was returned from server")})},getNumImages:function(a){this.getUserInfo(function(b,c){a(b,c?c.numImages:void 0)})},imageExists:function(a,b){this.getImageChecksum(a,function(a,c){return a?b(a):void this.imageWithChecksumExists(c,b)}.bind(this))},imageIdentifierExists:function(a,b){this.headImage(a,function(a,c){var d=c&&c.statusCode?c.statusCode:void 0;b(isNaN(a)?a:void 0,200===d)})},imageWithChecksumExists:function(a,b){var c=(new e).originalChecksums([a]).limit(1);this.getImages(c,function(a,c,d){if(a)return b(a);var e=d.hits>0;b(a,e,e?c[0].imageIdentifier:a)})},getImageData:function(a,b){var c=this.getImageUrl(a);this.getImageDataFromUrl(c,b)},getImageDataFromUrl:function(a,b){j.getContentsFromUrl(a.toString(),function(a,c,d){b(a,a?void 0:d)})},getHostForImageIdentifier:function(a,b){if(b)return this.options.hosts[0];var c=parseInt(a.slice(0,2),16);return this.options.hosts[c%this.options.hosts.length]},getImageChecksum:function(a,b){h.md5(a,b)},getImageChecksumFromBuffer:function(a,b){h.md5(a,b,{binary:!0,type:"string"})},parseUrls:function(a){"string"==typeof a&&(a=[a]);for(var b=[],c=0;c<a.length;c++)b.push(a[c].replace(/:80(\/|$)/,"$1").replace(/\/$/,""));return b},generateSignature:function(a,b,c){var d=[a,b,this.options.publicKey,c].join("|"),e=h.sha256(this.options.privateKey,d);return e},getSignedResourceUrl:function(a,b,c){var d=(c||new Date).toISOString().replace(/\.\d+Z$/,"Z"),e=this.generateSignature(a,b.toString(),d),f=b.toString().indexOf("?")>-1?"&":"?";return f+="signature="+encodeURIComponent(e),f+="&timestamp="+encodeURIComponent(d),b+f},headImage:function(a,b){i.head(this.getImageUrl(a,{usePrimaryHost:!0}),b)}}),b.exports=l},{"./browser/crypto":2,"./browser/feature-support":3,"./browser/readers":5,"./browser/request":6,"./imageurl":9,"./query":10,"./url":11,"./utils/extend":12,"./utils/jsonparse":13}],9:[function(a,b){"use strict";var c=a("./url"),d=a("./utils/extend"),e=function(a){return parseInt(a,10)},f=function(a){return!isNaN(a)},g=function(a){a=a||{},this.transformations=[],this.baseUrl=a.baseUrl,this.publicKey=a.publicKey,this.privateKey=a.privateKey,this.imageIdentifier=a.imageIdentifier||"",this.extension="",this.queryString=a.queryString,this.path=a.path||"",this.baseUrl+=["/users",this.publicKey,"images",this.imageIdentifier].join("/")};d(g.prototype,c.prototype),d(g.prototype,{autoRotate:function(){return this.append("autoRotate")},border:function(a){a=a||{};var b=["color="+(a.color||"000000").replace(/^#/,""),"width="+e(a.width||1),"height="+e(a.height||1),"mode="+(a.mode||"outbound")];return this.append("border:"+b.join(","))},canvas:function(a){if(a=a||{},!a.width||!a.height)throw new Error("width and height must be specified");var b=["width="+e(a.width),"height="+e(a.height)];return a.mode&&b.push("mode="+a.mode),a.x&&b.push("x="+e(a.x)),a.y&&b.push("y="+e(a.y)),a.bg&&b.push("bg="+a.bg.replace(/^#/,"")),this.append("canvas:"+b.join(","))},compress:function(a){var b=(a||{}).level||a;return this.append("compress:level="+(f(b)?b:75))},convert:function(a){return this.extension="."+a,this},crop:function(a){var b=a||{},c=b.mode,d=b.x,g=b.y,h=b.width,i=b.height;if(!c&&(isNaN(d)||isNaN(g)))throw new Error("x and y needs to be specified without a crop mode");if("center-x"===c&&isNaN(g))throw new Error("y needs to be specified when mode is center-x");if("center-y"===c&&isNaN(d))throw new Error("x needs to be specified when mode is center-y");if(isNaN(h)||isNaN(i))throw new Error("width and height needs to be specified");var j=["width="+e(h),"height="+e(i)];return f(d)&&j.push("x="+e(d)),f(g)&&j.push("y="+e(g)),c&&j.push("mode="+c),this.append("crop:"+j.join(","))},desaturate:function(){return this.append("desaturate")},flipHorizontally:function(){return this.append("flipHorizontally")},flipVertically:function(){return this.append("flipVertically")},maxSize:function(a){var b=[],c=a||{};if(c.width&&b.push("width="+e(c.width)),c.height&&b.push("height="+e(c.height)),!b.length)throw new Error("width and/or height needs to be specified");return this.append("maxSize:"+b.join(","))},modulate:function(a){var b=[],c=a||{};if(f(c.brightness)&&b.push("b="+c.brightness),f(c.saturation)&&b.push("s="+c.saturation),f(c.hue)&&b.push("h="+c.hue),!b.length)throw new Error("brightness, saturation or hue needs to be specified");return this.append("modulate:"+b.join(","))},progressive:function(){return this.append("progressive")},resize:function(a){var b=[],c=a||{};if(c.width&&b.push("width="+e(c.width)),c.height&&b.push("height="+e(c.height)),!b.length)throw new Error("width and/or height needs to be specified");return this.append("resize:"+b.join(","))},rotate:function(a){var b=a||{};if(isNaN(b.angle))throw new Error("angle needs to be specified");var c=(b.bg||"000000").replace(/^#/,"");return this.append("rotate:angle="+b.angle+",bg="+c)},sepia:function(a){var b=(a||{}).threshold||a;return this.append("sepia:threshold="+(f(b)?b:80))},strip:function(){return this.append("strip")},thumbnail:function(a){return a=a||{},this.append("thumbnail:width="+(a.width||50)+",height="+(a.height||50)+",fit="+(a.fit||"outbound"))},transpose:function(){return this.append("transpose")},transverse:function(){return this.append("transverse")},watermark:function(a){a=a||{};var b=["position="+(a.position||"top-left"),"x="+e(a.x||0),"y="+e(a.y||0)];return a.imageIdentifier&&b.push("img="+a.imageIdentifier),a.width>0&&b.push("width="+e(a.width)),a.height>0&&b.push("height="+e(a.height)),this.append("watermark:"+b.join(","))},gif:function(){return this.convert("gif")},jpg:function(){return this.convert("jpg")},png:function(){return this.convert("png")},reset:function(){return this.extension="",this.transformations=[],this},append:function(a){return this.transformations.push(a),this},getTransformations:function(){return this.transformations},getQueryString:function(a){var b=this.queryString||"",c=this.transformations,d=a?"t%5B%5D=":"t[]=";return a&&(c=c.map(encodeURIComponent)),this.transformations.length&&(b+=b.length?"&":"",b+=d+c.join("&"+d)),b}}),b.exports=g},{"./url":11,"./utils/extend":12}],10:[function(a,b){"use strict";var c=a("./utils/extend"),d=function(){this.values={},this.reset()};d.SORT_DESC="desc",d.SORT_ASC="asc",c(d.prototype,{appendValue:function(a,b){return this.values[a]=this.values[a].concat(b),this},setOrGet:function(a,b){return void 0===b?this.values[a]:(this.values[a]=[].concat(b),this)},ids:function(a){return this.setOrGet("ids",a)},addId:function(a){return this.appendValue("ids",a)},addIds:function(a){return this.addId(a)},checksums:function(a){return this.setOrGet("checksums",a)},addChecksum:function(a){return this.appendValue("checksums",a)},addChecksums:function(a){return this.addChecksum(a)},originalChecksums:function(a){return this.setOrGet("originalChecksums",a)},addOriginalChecksum:function(a){return this.appendValue("originalChecksums",a)},addOriginalChecksums:function(a){return this.addOriginalChecksum(a)},fields:function(a){return this.setOrGet("fields",a)},addField:function(a){return this.appendValue("fields",a)},addFields:function(a){return this.addField(a)},sort:function(a,b,c){if(Array.isArray(a)||void 0===a)return this.setOrGet("sort",a);var d=(b?[a,b]:[a]).join(":");return c?this.values.sort.push(d):this.values.sort=[d],this},addSort:function(a,b){return this.sort(a,b,!0)},addSorts:function(a){return this.appendValue("sort",a)},page:function(a){return a?(this.values.page=parseInt(a,10),this):this.values.page},limit:function(a){return a?(this.values.limit=a,this):this.values.limit},metadata:function(a){return"undefined"==typeof a?this.values.metadata:(this.values.metadata=!!a,this)},from:function(a){return a?(this.values.from=a instanceof Date?a:this.values.from,this):this.values.from},to:function(a){return a?(this.values.to=a instanceof Date?a:this.values.to,this):this.values.to},reset:function(){var a=this.values;return a.page=1,a.limit=20,a.metadata=!1,a.from=null,a.to=null,a.ids=[],a.checksums=[],a.fields=[],a.sort=[],a.originalChecksums=[],this},toQueryString:function(){var a,b={};for(a in this.values)!Array.isArray(this.values[a])&&this.values[a]&&(b[a]=this.values[a]);b.from&&(b.from=Math.floor(b.from.getTime()/1e3)),b.to&&(b.to=Math.floor(b.to.getTime()/1e3));var c=[];for(a in b)c.push(a+"="+b[a]);return["ids","checksums","originalChecksums","fields","sort"].forEach(function(a){this[a].forEach(function(b){c.push(a+"[]="+b)})}.bind(this.values)),c.join("&")},toString:function(){return this.toQueryString()}}),b.exports=d},{"./utils/extend":12}],11:[function(a,b){"use strict";var c=a("./browser/crypto"),d=a("./utils/extend"),e=function(a){a=a||{},this.transformations=[],this.baseUrl=a.baseUrl,this.publicKey=a.publicKey,this.privateKey=a.privateKey,this.extension=a.extension||"",this.imageIdentifier=a.imageIdentifier||"",this.path=a.path||"",this.queryString=a.queryString};d(e.prototype,{getPath:function(){return this.path},setPath:function(a){return this.path=a,this},getAccessToken:function(a){return c.sha256(this.privateKey,a)},setQueryString:function(a){return this.queryString=a,this},getQueryString:function(){return this.queryString||""},getUrl:function(){var a=this.baseUrl+this.extension+this.path,b=a,c=this.getQueryString();return c.length&&(b+="?"+this.getQueryString(!0),a+="?"+c),[b,a.indexOf("?")>-1?"&":"?","accessToken="+this.getAccessToken(a,this.privateKey)].join("")},toString:function(){return this.getUrl()}}),b.exports=e},{"./browser/crypto":2,"./utils/extend":12}],12:[function(a,b){"use strict";b.exports=function(a,b){for(var c in b)a[c]=b[c]}},{}],13:[function(a,b){"use strict";b.exports=function(a){var b;try{b=JSON.parse(a)}catch(c){b=null}return b}},{}],14:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],15:[function(a,b){b.exports={name:"imboclient",description:"An Imbo client for node.js and modern browsers",version:"2.3.0",author:"Espen Hovlandsdal <espen@hovlandsdal.com>",contributors:[],repository:{type:"git",url:"http://github.com/imbo/imboclient-js"},bugs:{url:"http://github.com/imbo/imboclient-js/issues"},dependencies:{request:"~2.34.0"},devDependencies:{grunt:"~0.4.2","grunt-browserify":"~2.0.0","grunt-contrib-uglify":"~0.3.2","grunt-contrib-jshint":"~0.8.0","grunt-contrib-watch":"~0.5.3","grunt-mocha-test":"~0.9.0","grunt-mocha-cov":"~0.2.0","grunt-replace":"~0.6.2",through:"~2.3.4",matchdep:"~0.3.0",mocha:"~1.17.1",nock:"~0.27.2",should:"~3.1.2",blanket:"~1.1.6",workerify:"~0.2.3"},scripts:{test:"grunt test",blanket:{pattern:"lib","data-cover-never":"node_modules"}},main:"index",engines:{node:">=0.10.0"},license:"MIT"}},{}]},{},[1])(1)});