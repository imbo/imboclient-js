/*! imboclient v 2.3.1-dev 2014-04-04 */
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Imbo=t()}}(function(){return function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return i(n?n:t)},h,h.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){n.Client=t("./lib/client"),n.Url=t("./lib/url/url"),n.ImageUrl=t("./lib/url/imageurl"),n.ShortUrl=t("./lib/url/shorturl"),n.Query=t("./lib/query"),n.Version=t("./package.json").version},{"./lib/client":8,"./lib/query":9,"./lib/url/imageurl":10,"./lib/url/shorturl":11,"./lib/url/url":12,"./package.json":16}],2:[function(t,e){(function(n){"use strict";var r,i=function(){if("undefined"==typeof window.Worker||"undefined"==typeof window.URL)return!1;try{new Worker(window.URL.createObjectURL(new Blob([""],{type:"text/javascript"})))}catch(t){return!1}return!0},o=t("./sha"),s=t("./md5.min"),u=t("./readers"),a="undefined"!=typeof window,h=a&&i(),c=[],f=function(){c.length>1||c.length&&r.postMessage(c[0].buffer)},d=function(t,e){h?(c.push({buffer:t,callback:e}),f()):n.nextTick(function(){e(void 0,s.ArrayBuffer.hash(t))})};h&&(r=new Worker(window.URL.createObjectURL(new Blob([';(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module \'"+n+"\'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(require,module,exports){\n(function(){/* global self */\n\'use strict\';\nvar md5 = require(\'./md5.min\');\nself.onmessage = function(e) {\n    self.postMessage(md5.ArrayBuffer.hash(e.data));\n};\n\n})()\n},{"./md5.min":2}],2:[function(require,module,exports){\n(function(r){module.exports=r()})(function(r){"use strict";var n=function(r,n){return r+n&4294967295},t=function(r,t,u,e,o,f){t=n(n(t,r),n(e,f));return n(t<<o|t>>>32-o,u)},u=function(r,n,u,e,o,f,a){return t(n&u|~n&e,r,n,o,f,a)},e=function(r,n,u,e,o,f,a){return t(n&e|u&~e,r,n,o,f,a)},o=function(r,n,u,e,o,f,a){return t(n^u^e,r,n,o,f,a)},f=function(r,n,u,e,o,f,a){return t(u^(n|~e),r,n,o,f,a)},a=function(r,t){var a=r[0],i=r[1],c=r[2],h=r[3];a=u(a,i,c,h,t[0],7,-680876936);h=u(h,a,i,c,t[1],12,-389564586);c=u(c,h,a,i,t[2],17,606105819);i=u(i,c,h,a,t[3],22,-1044525330);a=u(a,i,c,h,t[4],7,-176418897);h=u(h,a,i,c,t[5],12,1200080426);c=u(c,h,a,i,t[6],17,-1473231341);i=u(i,c,h,a,t[7],22,-45705983);a=u(a,i,c,h,t[8],7,1770035416);h=u(h,a,i,c,t[9],12,-1958414417);c=u(c,h,a,i,t[10],17,-42063);i=u(i,c,h,a,t[11],22,-1990404162);a=u(a,i,c,h,t[12],7,1804603682);h=u(h,a,i,c,t[13],12,-40341101);c=u(c,h,a,i,t[14],17,-1502002290);i=u(i,c,h,a,t[15],22,1236535329);a=e(a,i,c,h,t[1],5,-165796510);h=e(h,a,i,c,t[6],9,-1069501632);c=e(c,h,a,i,t[11],14,643717713);i=e(i,c,h,a,t[0],20,-373897302);a=e(a,i,c,h,t[5],5,-701558691);h=e(h,a,i,c,t[10],9,38016083);c=e(c,h,a,i,t[15],14,-660478335);i=e(i,c,h,a,t[4],20,-405537848);a=e(a,i,c,h,t[9],5,568446438);h=e(h,a,i,c,t[14],9,-1019803690);c=e(c,h,a,i,t[3],14,-187363961);i=e(i,c,h,a,t[8],20,1163531501);a=e(a,i,c,h,t[13],5,-1444681467);h=e(h,a,i,c,t[2],9,-51403784);c=e(c,h,a,i,t[7],14,1735328473);i=e(i,c,h,a,t[12],20,-1926607734);a=o(a,i,c,h,t[5],4,-378558);h=o(h,a,i,c,t[8],11,-2022574463);c=o(c,h,a,i,t[11],16,1839030562);i=o(i,c,h,a,t[14],23,-35309556);a=o(a,i,c,h,t[1],4,-1530992060);h=o(h,a,i,c,t[4],11,1272893353);c=o(c,h,a,i,t[7],16,-155497632);i=o(i,c,h,a,t[10],23,-1094730640);a=o(a,i,c,h,t[13],4,681279174);h=o(h,a,i,c,t[0],11,-358537222);c=o(c,h,a,i,t[3],16,-722521979);i=o(i,c,h,a,t[6],23,76029189);a=o(a,i,c,h,t[9],4,-640364487);h=o(h,a,i,c,t[12],11,-421815835);c=o(c,h,a,i,t[15],16,530742520);i=o(i,c,h,a,t[2],23,-995338651);a=f(a,i,c,h,t[0],6,-198630844);h=f(h,a,i,c,t[7],10,1126891415);c=f(c,h,a,i,t[14],15,-1416354905);i=f(i,c,h,a,t[5],21,-57434055);a=f(a,i,c,h,t[12],6,1700485571);h=f(h,a,i,c,t[3],10,-1894986606);c=f(c,h,a,i,t[10],15,-1051523);i=f(i,c,h,a,t[1],21,-2054922799);a=f(a,i,c,h,t[8],6,1873313359);h=f(h,a,i,c,t[15],10,-30611744);c=f(c,h,a,i,t[6],15,-1560198380);i=f(i,c,h,a,t[13],21,1309151649);a=f(a,i,c,h,t[4],6,-145523070);h=f(h,a,i,c,t[11],10,-1120210379);c=f(c,h,a,i,t[2],15,718787259);i=f(i,c,h,a,t[9],21,-343485551);r[0]=n(a,r[0]);r[1]=n(i,r[1]);r[2]=n(c,r[2]);r[3]=n(h,r[3])},i=function(r){var n=[],t;for(t=0;t<64;t+=4){n[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24)}return n},c=function(r){var n=[],t;for(t=0;t<64;t+=4){n[t>>2]=r[t]+(r[t+1]<<8)+(r[t+2]<<16)+(r[t+3]<<24)}return n},h=function(r){var n=r.length,t=[1732584193,-271733879,-1732584194,271733878],u,e,o,f,c,h;for(u=64;u<=n;u+=64){a(t,i(r.substring(u-64,u)))}r=r.substring(u-64);e=r.length;o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(u=0;u<e;u+=1){o[u>>2]|=r.charCodeAt(u)<<(u%4<<3)}o[u>>2]|=128<<(u%4<<3);if(u>55){a(t,o);for(u=0;u<16;u+=1){o[u]=0}}f=n*8;f=f.toString(16).match(/(.*?)(.{0,8})$/);c=parseInt(f[2],16);h=parseInt(f[1],16)||0;o[14]=c;o[15]=h;a(t,o);return t},s=function(r){var n=r.length,t=[1732584193,-271733879,-1732584194,271733878],u,e,o,f,i,h;for(u=64;u<=n;u+=64){a(t,c(r.subarray(u-64,u)))}r=u-64<n?r.subarray(u-64):new Uint8Array(0);e=r.length;o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(u=0;u<e;u+=1){o[u>>2]|=r[u]<<(u%4<<3)}o[u>>2]|=128<<(u%4<<3);if(u>55){a(t,o);for(u=0;u<16;u+=1){o[u]=0}}f=n*8;f=f.toString(16).match(/(.*?)(.{0,8})$/);i=parseInt(f[2],16);h=parseInt(f[1],16)||0;o[14]=i;o[15]=h;a(t,o);return t},v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],d=function(r){var n="",t;for(t=0;t<4;t+=1){n+=v[r>>t*8+4&15]+v[r>>t*8&15]}return n},g=function(r){var n;for(n=0;n<r.length;n+=1){r[n]=d(r[n])}return r.join("")},A=function(r){return g(h(r))};var b=function(){this.reset()};if(A("hello")!=="5d41402abc4b2a76b9719d911017c592"){n=function(r,n){var t=(r&65535)+(n&65535),u=(r>>16)+(n>>16)+(t>>16);return u<<16|t&65535}}b.ArrayBuffer=function(){};b.ArrayBuffer.hash=function(r){return g(s(new Uint8Array(r)))};return b});\n},{}]},{},[1])\n;'],{type:"text/javascript"}))),r.addEventListener("message",function(t){var e=c.shift();e.callback(void 0,t.data),f()},!1)),e.exports={sha256:function(t,e){return o.sha256hmac(t,e)},md5:function(t,r,i){return i&&"url"===i.type?u.getContentsFromUrl(t,function(t,n){e.exports.md5(n,r,{binary:!0})}):t instanceof window.File?u.getContentsFromFile(t,function(t,n){e.exports.md5(n,r,{binary:!0})}):void n.nextTick(function(){d(t,r)})}}}).call(this,t("/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./md5.min":4,"./readers":5,"./sha":7,"/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":15}],3:[function(t,e,n){"use strict";n.checkFeatures=function(t){if("undefined"!=typeof window||t){var e=n.getUnsupported(t);if(e.length)throw new Error("Browser does not support "+e.join(", "))}},n.getUnsupported=function(t){var e=t||window,n=[];return e.FileReader||n.push("FileReader"),e.ArrayBuffer||n.push("ArrayBuffer"),e.XMLHttpRequest?"upload"in new e.XMLHttpRequest||n.push("XMLHttpRequest2"):n.push("XMLHttpRequest"),n}},{}],4:[function(t,e){!function(t){e.exports=t()}(function(){"use strict";var t=function(t,e){return t+e&4294967295},e=function(e,n,r,i,o,s){return n=t(t(n,e),t(i,s)),t(n<<o|n>>>32-o,r)},n=function(t,n,r,i,o,s,u){return e(n&r|~n&i,t,n,o,s,u)},r=function(t,n,r,i,o,s,u){return e(n&i|r&~i,t,n,o,s,u)},i=function(t,n,r,i,o,s,u){return e(n^r^i,t,n,o,s,u)},o=function(t,n,r,i,o,s,u){return e(r^(n|~i),t,n,o,s,u)},s=function(e,s){var u=e[0],a=e[1],h=e[2],c=e[3];u=n(u,a,h,c,s[0],7,-680876936),c=n(c,u,a,h,s[1],12,-389564586),h=n(h,c,u,a,s[2],17,606105819),a=n(a,h,c,u,s[3],22,-1044525330),u=n(u,a,h,c,s[4],7,-176418897),c=n(c,u,a,h,s[5],12,1200080426),h=n(h,c,u,a,s[6],17,-1473231341),a=n(a,h,c,u,s[7],22,-45705983),u=n(u,a,h,c,s[8],7,1770035416),c=n(c,u,a,h,s[9],12,-1958414417),h=n(h,c,u,a,s[10],17,-42063),a=n(a,h,c,u,s[11],22,-1990404162),u=n(u,a,h,c,s[12],7,1804603682),c=n(c,u,a,h,s[13],12,-40341101),h=n(h,c,u,a,s[14],17,-1502002290),a=n(a,h,c,u,s[15],22,1236535329),u=r(u,a,h,c,s[1],5,-165796510),c=r(c,u,a,h,s[6],9,-1069501632),h=r(h,c,u,a,s[11],14,643717713),a=r(a,h,c,u,s[0],20,-373897302),u=r(u,a,h,c,s[5],5,-701558691),c=r(c,u,a,h,s[10],9,38016083),h=r(h,c,u,a,s[15],14,-660478335),a=r(a,h,c,u,s[4],20,-405537848),u=r(u,a,h,c,s[9],5,568446438),c=r(c,u,a,h,s[14],9,-1019803690),h=r(h,c,u,a,s[3],14,-187363961),a=r(a,h,c,u,s[8],20,1163531501),u=r(u,a,h,c,s[13],5,-1444681467),c=r(c,u,a,h,s[2],9,-51403784),h=r(h,c,u,a,s[7],14,1735328473),a=r(a,h,c,u,s[12],20,-1926607734),u=i(u,a,h,c,s[5],4,-378558),c=i(c,u,a,h,s[8],11,-2022574463),h=i(h,c,u,a,s[11],16,1839030562),a=i(a,h,c,u,s[14],23,-35309556),u=i(u,a,h,c,s[1],4,-1530992060),c=i(c,u,a,h,s[4],11,1272893353),h=i(h,c,u,a,s[7],16,-155497632),a=i(a,h,c,u,s[10],23,-1094730640),u=i(u,a,h,c,s[13],4,681279174),c=i(c,u,a,h,s[0],11,-358537222),h=i(h,c,u,a,s[3],16,-722521979),a=i(a,h,c,u,s[6],23,76029189),u=i(u,a,h,c,s[9],4,-640364487),c=i(c,u,a,h,s[12],11,-421815835),h=i(h,c,u,a,s[15],16,530742520),a=i(a,h,c,u,s[2],23,-995338651),u=o(u,a,h,c,s[0],6,-198630844),c=o(c,u,a,h,s[7],10,1126891415),h=o(h,c,u,a,s[14],15,-1416354905),a=o(a,h,c,u,s[5],21,-57434055),u=o(u,a,h,c,s[12],6,1700485571),c=o(c,u,a,h,s[3],10,-1894986606),h=o(h,c,u,a,s[10],15,-1051523),a=o(a,h,c,u,s[1],21,-2054922799),u=o(u,a,h,c,s[8],6,1873313359),c=o(c,u,a,h,s[15],10,-30611744),h=o(h,c,u,a,s[6],15,-1560198380),a=o(a,h,c,u,s[13],21,1309151649),u=o(u,a,h,c,s[4],6,-145523070),c=o(c,u,a,h,s[11],10,-1120210379),h=o(h,c,u,a,s[2],15,718787259),a=o(a,h,c,u,s[9],21,-343485551),e[0]=t(u,e[0]),e[1]=t(a,e[1]),e[2]=t(h,e[2]),e[3]=t(c,e[3])},u=function(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n},a=function(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n},h=function(t){var e,n,r,i,o,a,h=t.length,c=[1732584193,-271733879,-1732584194,271733878];for(e=64;h>=e;e+=64)s(c,u(t.substring(e-64,e)));for(t=t.substring(e-64),n=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;n>e;e+=1)r[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(s(c,r),e=0;16>e;e+=1)r[e]=0;return i=8*h,i=i.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,r[14]=o,r[15]=a,s(c,r),c},c=function(t){var e,n,r,i,o,u,h=t.length,c=[1732584193,-271733879,-1732584194,271733878];for(e=64;h>=e;e+=64)s(c,a(t.subarray(e-64,e)));for(t=h>e-64?t.subarray(e-64):new Uint8Array(0),n=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;n>e;e+=1)r[e>>2]|=t[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(s(c,r),e=0;16>e;e+=1)r[e]=0;return i=8*h,i=i.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),u=parseInt(i[1],16)||0,r[14]=o,r[15]=u,s(c,r),c},f=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],d=function(t){var e,n="";for(e=0;4>e;e+=1)n+=f[t>>8*e+4&15]+f[t>>8*e&15];return n},l=function(t){var e;for(e=0;e<t.length;e+=1)t[e]=d(t[e]);return t.join("")},p=function(t){return l(h(t))},g=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==p("hello")&&(t=function(t,e){var n=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(n>>16);return r<<16|65535&n}),g.ArrayBuffer=function(){},g.ArrayBuffer.hash=function(t){return l(c(new Uint8Array(t)))},g})},{}],5:[function(t,e,n){"use strict";n.getContentsFromFile=function(t,e){var n=new FileReader;n.onload=function(t){return e(void 0,t.target.result)},n.readAsArrayBuffer(t)},n.getContentsFromUrl=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&e(void 0,n.responseText)},n.send(null)}},{}],6:[function(t,e){"use strict";function n(t){t.method=t.method.toUpperCase(),t.uri=t.uri.toString();var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&0!==e.status&&t.onComplete&&t.onComplete(e.status>=400?e.status+" "+e.statusText:void 0,i(e),t.json?JSON.parse(e.responseText):e.responseText)},e.onerror=function(){t.onComplete("XHR error - CORS denied?",i(e))},t.onProgress&&e.upload.addEventListener("progress",t.onProgress,!1),e.open(t.method,t.uri,!0);for(var n in t.headers)r.indexOf(n)>-1||e.setRequestHeader(n,t.headers[n]);t.json&&(e.setRequestHeader("Accept","application/json"),"boolean"!=typeof t.json&&(e.setRequestHeader("Content-Type","application/json"),t.body=JSON.stringify(t.json))),e.send(t.body)}var r=["User-Agent","Content-Length"],i=function(t){for(var e={headers:{},statusCode:t.status},n=t.getAllResponseHeaders().split("\r\n"),r=0;r<n.length;r++){var i=n[r],o=i.indexOf(": ");if(o>0){var s=i.substring(0,o),u=i.substring(o+2);e.headers[s.toLowerCase()]=u}}return e};n.short=function(t,e,r){var i={method:t,uri:e,onComplete:r};"GET"===t&&(i.json=!0),n(i)},n.get=function(t,e){n.short("GET",t,e)},n.del=function(t,e){n.short("DELETE",t,e)},n.head=function(t,e){n.short("HEAD",t,e)},e.exports=n},{}],7:[function(t,e,n){"use strict";var r=8,i=function(t,e){var n=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(n>>16);return r<<16|65535&n},o=function(t,e){return t>>>e|t<<32-e},s=function(t,e){return t>>>e},u=function(t,e,n){return t&e^~t&n},a=function(t,e,n){return t&e^t&n^e&n},h=function(t){return o(t,2)^o(t,13)^o(t,22)},c=function(t){return o(t,6)^o(t,11)^o(t,25)},f=function(t){return o(t,7)^o(t,18)^s(t,3)},d=function(t){return o(t,17)^o(t,19)^s(t,10)},l=function(t,e){var n,r,o,s,l,p,g,m,v,y,b,w,U=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],I=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],x=new Array(64);for(t[e>>5]|=128<<24-e%32,t[(e+64>>9<<4)+15]=e,v=0;v<t.length;v+=16){for(n=I[0],r=I[1],o=I[2],s=I[3],l=I[4],p=I[5],g=I[6],m=I[7],y=0;64>y;y++)x[y]=16>y?t[y+v]:i(i(i(d(x[y-2]),x[y-7]),f(x[y-15])),x[y-16]),b=i(i(i(i(m,c(l)),u(l,p,g)),U[y]),x[y]),w=i(h(n),a(n,r,o)),m=g,g=p,p=l,l=i(s,b),s=o,o=r,r=n,n=i(b,w);I[0]=i(n,I[0]),I[1]=i(r,I[1]),I[2]=i(o,I[2]),I[3]=i(s,I[3]),I[4]=i(l,I[4]),I[5]=i(p,I[5]),I[6]=i(g,I[6]),I[7]=i(m,I[7])}return I},p=function(t){for(var e=Array(),n=(1<<r)-1,i=0;i<t.length*r;i+=r)e[i>>5]|=(t.charCodeAt(i/r)&n)<<24-i%32;return e},g=function(t){for(var e="0123456789abcdef",n="",r=0;r<4*t.length;r++)n+=e.charAt(t[r>>2]>>8*(3-r%4)+4&15)+e.charAt(t[r>>2]>>8*(3-r%4)&15);return n},m=function(t,e){var n=p(t);n.length>16&&(n=l(n,t.length*r));for(var i=new Array(16),o=new Array(16),s=0;16>s;s++)i[s]=909522486^n[s],o[s]=1549556828^n[s];var u=l(i.concat(p(e)),512+e.length*r);return l(o.concat(u),768)};n.sha256=function(t){return g(l(t,t.length*r))},n.sha256hmac=function(t,e){return g(m(t,e))}},{}],8:[function(t,e){"use strict";var n=t("./url/url"),r=t("./url/imageurl"),i=t("./url/shorturl"),o=t("./query"),s=t("./utils/extend"),u=t("./utils/jsonparse"),a=t("./browser/crypto"),h=t("./browser/request"),c=t("./browser/readers"),f=t("./browser/feature-support"),d=function(t,e,n){this.options={hosts:this.parseUrls(t),publicKey:e,privateKey:n},f.checkFeatures()};s(d.prototype,{addImage:function(t,e){return"undefined"!=typeof window&&t instanceof window.File?this.addImageFromBuffer(t,e):void c.getLengthOfFile(t,function(n,r){return n?e(n):void c.createReadStream(t).pipe(h({method:"POST",uri:this.getSignedResourceUrl("POST",this.getImagesUrl()),json:!0,headers:{Accept:"application/json","User-Agent":"imboclient-js","Content-Length":r},onComplete:function(t,n,r){e(t,r?r.imageIdentifier:void 0,r,n)}}))}.bind(this))},addImageFromBuffer:function(t,e){var n=this.getSignedResourceUrl("POST",this.getImagesUrl()),r="undefined"!=typeof window&&t instanceof window.File,i=e.onComplete||e,o=e.onProgress||null;h({method:"POST",uri:n,body:t,headers:{Accept:"application/json","User-Agent":"imboclient-js","Content-Length":r?t.size:t.length},onComplete:function(t,e,n){n=u(n),i(t,n?n.imageIdentifier:void 0,n,e)},onProgress:o})},addImageFromUrl:function(t,e){return"undefined"!=typeof window?c.getContentsFromUrl(t,function(t,n,r){return t?e(t):void this.addImageFromBuffer(r,e)}.bind(this)):void h({uri:t}).pipe(h({method:"POST",uri:this.getSignedResourceUrl("POST",this.getImagesUrl()),json:!0,headers:{Accept:"application/json","User-Agent":"imboclient-js"},onComplete:function(t,n,r){e(t,r?r.imageIdentifier:void 0,r,n)}}))},getServerStats:function(t){h.get(this.getStatsUrl(),function(e,n,r){t(e,r,n)})},getServerStatus:function(t){h.get(this.getStatusUrl(),function(e,n,r){return e?t(e):(r=r||{},r.status=n.statusCode,r.date=new Date(r.date),void t(e,r,n))})},getUserInfo:function(t){h.get(this.getUserUrl(),function(e,n,r){r&&r.lastModified&&(r.lastModified=new Date(r.lastModified)),t(e,r,n)})},deleteImage:function(t,e){var n=this.getImageUrl(t,{usePrimaryHost:!0}),r=this.getSignedResourceUrl("DELETE",n);h.del(r,e)},getImageProperties:function(t,e){this.headImage(t,function(t,n){if(t)return e(t);var r=n.headers,i="x-imbo-original";e(t,{width:parseInt(r[i+"width"],10),height:parseInt(r[i+"height"],10),filesize:parseInt(r[i+"filesize"],10),extension:r[i+"extension"],mimetype:r[i+"mimetype"]})})},editMetadata:function(t,e,n,r){var i=this.getMetadataUrl(t);h({method:r||"POST",uri:this.getSignedResourceUrl(r||"POST",i),json:e,onComplete:function(t,e,r){n(t,r,e)}})},replaceMetadata:function(t,e,n){this.editMetadata(t,e,n,"PUT")},getMetadata:function(t,e){h.get(this.getMetadataUrl(t),function(t,n,r){e(t,r,n)})},deleteMetadata:function(t,e){var n=this.getMetadataUrl(t);h.del(this.getSignedResourceUrl("DELETE",n),e)},getImages:function(t,e){"function"!=typeof t||e||(e=t,t=null),h.get(this.getImagesUrl(t),function(t,n,r){e(t,r?r.images:[],r?r.search:{},n)})},getStatusUrl:function(){return this.getResourceUrl({path:"/status"})},getStatsUrl:function(){return this.getResourceUrl({path:"/stats"})},getUserUrl:function(){return this.getResourceUrl({path:"/users/"+this.options.publicKey})},getImagesUrl:function(t){var e=this.getUserUrl();return e.setPath(e.getPath()+"/images"),t&&e.setQueryString(t.toString()),e},getImageUrl:function(t,e){return e=e||{},new r({baseUrl:this.getHostForImageIdentifier(t,e.usePrimaryHost),path:e.path,publicKey:this.options.publicKey,privateKey:this.options.privateKey,imageIdentifier:t})},getMetadataUrl:function(t){return this.getImageUrl(t,{path:"/meta",usePrimaryHost:!0})},getResourceUrl:function(t){return new n({baseUrl:this.options.hosts[0],publicKey:this.options.publicKey,privateKey:this.options.privateKey,queryString:t.query,path:t.path})},getShortUrl:function(t,e){var n=t.clone(),r=n.getExtension(),o=n.getImageIdentifier(),s=this.getHostForImageIdentifier(o),u={imageIdentifier:o,publicKey:n.getPublicKey(),query:n.getQueryString()};r&&(u.extension=r),n.reset().setPath("/shorturls"),h({method:"POST",uri:this.getSignedResourceUrl("POST",n.toString()),json:u,onComplete:function(t,n,r){return t?e(t):r&&r.id?void e(t,new i({baseUrl:s,id:r.id})):e("No ShortUrl was returned from server")}})},deleteAllShortUrlsForImage:function(t,e){var n=this.getImageUrl(t).setPath("/shorturls"),r=this.getSignedResourceUrl("DELETE",n);h.del(r,e)},deleteShortUrlForImage:function(t,e,n){var r=e instanceof i?e.getId():e,o=this.getImageUrl(t).setPath("/shorturls/"+r),s=this.getSignedResourceUrl("DELETE",o);h.del(s,n)},getNumImages:function(t){this.getUserInfo(function(e,n){t(e,n?n.numImages:void 0)})},imageExists:function(t,e){this.getImageChecksum(t,function(t,n){return t?e(t):void this.imageWithChecksumExists(n,e)}.bind(this))},imageIdentifierExists:function(t,e){this.headImage(t,function(t,n){var r=n&&n.statusCode?n.statusCode:void 0;e(isNaN(t)?t:void 0,200===r)})},imageWithChecksumExists:function(t,e){var n=(new o).originalChecksums([t]).limit(1);this.getImages(n,function(t,n,r){if(t)return e(t);var i=r.hits>0;e(t,i,i?n[0].imageIdentifier:t)})},getImageData:function(t,e){var n=this.getImageUrl(t);this.getImageDataFromUrl(n,e)},getImageDataFromUrl:function(t,e){c.getContentsFromUrl(t.toString(),function(t,n,r){e(t,t?void 0:r)})},getHostForImageIdentifier:function(t,e){if(e)return this.options.hosts[0];var n=parseInt(t.slice(0,2),16);return this.options.hosts[n%this.options.hosts.length]},getImageChecksum:function(t,e){a.md5(t,e)},getImageChecksumFromBuffer:function(t,e){a.md5(t,e,{binary:!0,type:"string"})},parseUrls:function(t){"string"==typeof t&&(t=[t]);for(var e=[],n=0;n<t.length;n++)e.push(t[n].replace(/:80(\/|$)/,"$1").replace(/\/$/,""));return e},generateSignature:function(t,e,n){var r=[t,e,this.options.publicKey,n].join("|"),i=a.sha256(this.options.privateKey,r);return i},getSignedResourceUrl:function(t,e,n){var r=(n||new Date).toISOString().replace(/\.\d+Z$/,"Z"),i=this.generateSignature(t,e.toString(),r),o=e.toString().indexOf("?")>-1?"&":"?";return o+="signature="+encodeURIComponent(i),o+="&timestamp="+encodeURIComponent(r),e+o},headImage:function(t,e){h.head(this.getImageUrl(t,{usePrimaryHost:!0}),e)}}),e.exports=d},{"./browser/crypto":2,"./browser/feature-support":3,"./browser/readers":5,"./browser/request":6,"./query":9,"./url/imageurl":10,"./url/shorturl":11,"./url/url":12,"./utils/extend":13,"./utils/jsonparse":14}],9:[function(t,e){"use strict";var n=t("./utils/extend"),r=function(){this.values={},this.reset()};r.SORT_DESC="desc",r.SORT_ASC="asc",n(r.prototype,{appendValue:function(t,e){return this.values[t]=this.values[t].concat(e),this},setOrGet:function(t,e){return void 0===e?this.values[t]:(this.values[t]=[].concat(e),this)},ids:function(t){return this.setOrGet("ids",t)},addId:function(t){return this.appendValue("ids",t)},addIds:function(t){return this.addId(t)},checksums:function(t){return this.setOrGet("checksums",t)},addChecksum:function(t){return this.appendValue("checksums",t)},addChecksums:function(t){return this.addChecksum(t)},originalChecksums:function(t){return this.setOrGet("originalChecksums",t)},addOriginalChecksum:function(t){return this.appendValue("originalChecksums",t)},addOriginalChecksums:function(t){return this.addOriginalChecksum(t)},fields:function(t){return this.setOrGet("fields",t)},addField:function(t){return this.appendValue("fields",t)},addFields:function(t){return this.addField(t)},sort:function(t,e,n){if(Array.isArray(t)||void 0===t)return this.setOrGet("sort",t);var r=(e?[t,e]:[t]).join(":");return n?this.values.sort.push(r):this.values.sort=[r],this},addSort:function(t,e){return this.sort(t,e,!0)},addSorts:function(t){return this.appendValue("sort",t)},page:function(t){return t?(this.values.page=parseInt(t,10),this):this.values.page},limit:function(t){return t?(this.values.limit=t,this):this.values.limit},metadata:function(t){return"undefined"==typeof t?this.values.metadata:(this.values.metadata=!!t,this)},from:function(t){return t?(this.values.from=t instanceof Date?t:this.values.from,this):this.values.from},to:function(t){return t?(this.values.to=t instanceof Date?t:this.values.to,this):this.values.to},reset:function(){var t=this.values;return t.page=1,t.limit=20,t.metadata=!1,t.from=null,t.to=null,t.ids=[],t.checksums=[],t.fields=[],t.sort=[],t.originalChecksums=[],this},toQueryString:function(){var t,e={};for(t in this.values)!Array.isArray(this.values[t])&&this.values[t]&&(e[t]=this.values[t]);e.from&&(e.from=Math.floor(e.from.getTime()/1e3)),e.to&&(e.to=Math.floor(e.to.getTime()/1e3));var n=[];for(t in e)n.push(t+"="+e[t]);return["ids","checksums","originalChecksums","fields","sort"].forEach(function(t){this[t].forEach(function(e){n.push(t+"[]="+e)})}.bind(this.values)),n.join("&")},toString:function(){return this.toQueryString()}}),e.exports=r},{"./utils/extend":13}],10:[function(t,e){"use strict";var n=t("./url"),r=t("../utils/extend"),i=function(t){return parseInt(t,10)},o=function(t){return!isNaN(t)},s=function(t){t=t||{},this.transformations=t.transformations||[],this.rootUrl=t.baseUrl,this.baseUrl=t.baseUrl,this.publicKey=t.publicKey,this.privateKey=t.privateKey,this.imageIdentifier=t.imageIdentifier||"",this.extension=t.extension,this.queryString=t.queryString,this.path=t.path||"",this.baseUrl+=["/users",this.publicKey,"images",this.imageIdentifier].join("/")};r(s.prototype,n.prototype),r(s.prototype,{autoRotate:function(){return this.append("autoRotate")},border:function(t){t=t||{};var e=["color="+(t.color||"000000").replace(/^#/,""),"width="+i(t.width||1),"height="+i(t.height||1),"mode="+(t.mode||"outbound")];return this.append("border:"+e.join(","))},canvas:function(t){if(t=t||{},!t.width||!t.height)throw new Error("width and height must be specified");var e=["width="+i(t.width),"height="+i(t.height)];return t.mode&&e.push("mode="+t.mode),t.x&&e.push("x="+i(t.x)),t.y&&e.push("y="+i(t.y)),t.bg&&e.push("bg="+t.bg.replace(/^#/,"")),this.append("canvas:"+e.join(","))},compress:function(t){var e=(t||{}).level||t;return this.append("compress:level="+(o(e)?e:75))},convert:function(t){return this.extension=t,this},crop:function(t){var e=t||{},n=e.mode,r=e.x,s=e.y,u=e.width,a=e.height;if(!n&&(isNaN(r)||isNaN(s)))throw new Error("x and y needs to be specified without a crop mode");if("center-x"===n&&isNaN(s))throw new Error("y needs to be specified when mode is center-x");if("center-y"===n&&isNaN(r))throw new Error("x needs to be specified when mode is center-y");if(isNaN(u)||isNaN(a))throw new Error("width and height needs to be specified");var h=["width="+i(u),"height="+i(a)];return o(r)&&h.push("x="+i(r)),o(s)&&h.push("y="+i(s)),n&&h.push("mode="+n),this.append("crop:"+h.join(","))},desaturate:function(){return this.append("desaturate")},flipHorizontally:function(){return this.append("flipHorizontally")},flipVertically:function(){return this.append("flipVertically")},maxSize:function(t){var e=[],n=t||{};if(n.width&&e.push("width="+i(n.width)),n.height&&e.push("height="+i(n.height)),!e.length)throw new Error("width and/or height needs to be specified");return this.append("maxSize:"+e.join(","))},modulate:function(t){var e=[],n=t||{};if(o(n.brightness)&&e.push("b="+n.brightness),o(n.saturation)&&e.push("s="+n.saturation),o(n.hue)&&e.push("h="+n.hue),!e.length)throw new Error("brightness, saturation or hue needs to be specified");return this.append("modulate:"+e.join(","))},progressive:function(){return this.append("progressive")},resize:function(t){var e=[],n=t||{};if(n.width&&e.push("width="+i(n.width)),n.height&&e.push("height="+i(n.height)),!e.length)throw new Error("width and/or height needs to be specified");return this.append("resize:"+e.join(","))},rotate:function(t){var e=t||{};if(isNaN(e.angle))throw new Error("angle needs to be specified");var n=(e.bg||"000000").replace(/^#/,"");return this.append("rotate:angle="+e.angle+",bg="+n)},sepia:function(t){var e=(t||{}).threshold||t;return this.append("sepia:threshold="+(o(e)?e:80))},strip:function(){return this.append("strip")},thumbnail:function(t){return t=t||{},this.append("thumbnail:width="+(t.width||50)+",height="+(t.height||50)+",fit="+(t.fit||"outbound"))},transpose:function(){return this.append("transpose")},transverse:function(){return this.append("transverse")},watermark:function(t){t=t||{};var e=["position="+(t.position||"top-left"),"x="+i(t.x||0),"y="+i(t.y||0)];return t.imageIdentifier&&e.push("img="+t.imageIdentifier),t.width>0&&e.push("width="+i(t.width)),t.height>0&&e.push("height="+i(t.height)),this.append("watermark:"+e.join(","))},gif:function(){return this.convert("gif")},jpg:function(){return this.convert("jpg")},png:function(){return this.convert("png")},reset:function(){return this.extension=void 0,this.transformations=[],this},clone:function(){return new s({transformations:(this.transformations||[]).slice(0),baseUrl:this.rootUrl,publicKey:this.publicKey,privateKey:this.privateKey,imageIdentifier:this.imageIdentifier,extension:this.extension,queryString:this.queryString,path:this.path})},append:function(t){return this.transformations.push(t),this},getTransformations:function(){return this.transformations},getExtension:function(){return this.extension},getImageIdentifier:function(){return this.imageIdentifier},getQueryString:function(t){var e=this.queryString||"",n=this.transformations,r=t?"t%5B%5D=":"t[]=";return t&&(n=n.map(encodeURIComponent)),this.transformations.length&&(e+=e.length?"&":"",e+=r+n.join("&"+r)),e}}),e.exports=s},{"../utils/extend":13,"./url":12}],11:[function(t,e){"use strict";var n=t("../utils/extend"),r=function(t){t=t||{},this.baseUrl=t.baseUrl,this.shortId=t.id};n(r.prototype,{getId:function(){return this.shortId},getUrl:function(){return this.baseUrl+"/s/"+this.shortId},toString:function(){return this.getUrl()}}),e.exports=r},{"../utils/extend":13}],12:[function(t,e){"use strict";var n=t("../browser/crypto"),r=t("../utils/extend"),i=function(t){t=t||{},this.transformations=[],this.baseUrl=t.baseUrl,this.publicKey=t.publicKey,this.privateKey=t.privateKey,this.extension=t.extension,this.imageIdentifier=t.imageIdentifier||"",this.path=t.path||"",this.queryString=t.queryString};r(i.prototype,{getPublicKey:function(){return this.publicKey},getPath:function(){return this.path},setPath:function(t){return this.path=t,this},getAccessToken:function(t){return n.sha256(this.privateKey,t)},setQueryString:function(t){return this.queryString=t,this},getQueryString:function(){return this.queryString||""},getUrl:function(){var t=this.extension?"."+this.extension:"",e=this.baseUrl+t+this.path,n=e,r=this.getQueryString();return r.length&&(n+="?"+this.getQueryString(!0),e+="?"+r),[n,e.indexOf("?")>-1?"&":"?","accessToken="+this.getAccessToken(e,this.privateKey)].join("")},toString:function(){return this.getUrl()}}),e.exports=i},{"../browser/crypto":2,"../utils/extend":13}],13:[function(t,e){"use strict";e.exports=function(t,e){for(var n in e)t[n]=e[n]}},{}],14:[function(t,e){"use strict";e.exports=function(t){var e;try{e=JSON.parse(t)}catch(n){e=null}return e}},{}],15:[function(t,e){function n(){}var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=n,r.once=n,r.off=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],16:[function(t,e){e.exports={name:"imboclient",description:"An Imbo client for node.js and modern browsers",version:"2.3.1-dev",author:"Espen Hovlandsdal <espen@hovlandsdal.com>",contributors:[],repository:{type:"git",url:"http://github.com/imbo/imboclient-js"},bugs:{url:"http://github.com/imbo/imboclient-js/issues"},dependencies:{request:"~2.34.0"},devDependencies:{gulp:"~3.6.0","gulp-util":"~2.2.14","gulp-mocha":"~0.4.1","gulp-istanbul":"~0.1.1","gulp-browserify":"~0.5.0","gulp-clean":"~0.2.4","gulp-rename":"~1.2.0","gulp-uglify":"~0.2.1","gulp-insert":"~0.2.0","gulp-replace":"~0.2.0",coveralls:"~2.10.0",through:"~2.3.4",matchdep:"~0.3.0",mocha:"~1.18.2",nock:"~0.27.2",should:"~3.2.0",blanket:"~1.1.6",workerify:"~0.2.3"},scripts:{test:"gulp test",coveralls:"cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js"},main:"index",engines:{node:">=0.10.0"},license:"MIT"}
},{}]},{},[1])(1)});